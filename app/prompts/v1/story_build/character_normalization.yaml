# Character Normalization Prompt
# Version: 2.0 (Style-Neutral)
# Description: Enrich character profiles with detailed morphological descriptions (style-agnostic)
# Required Variables: characters_json, story_context
# Optional Variables: image_style_guide, character_style_guide
# Output Schema: { characters: [{ name, role, description, gender, age_range, appearance, outfit, identity_line }] }

prompt_character_normalization: |
  {{ system_prompt_json }}
  {{ global_constraints }}

  Enrich the following character profiles with DETAILED morphological descriptions for image generation.
  Use context clues from the story to infer appearance. Focus on OBJECTIVE PHYSICAL CHARACTERISTICS ONLY.

  **CRITICAL CONSTRAINT: Focus on objective morphological descriptions only. DO NOT include style-specific keywords.**
  **DEMOGRAPHIC INFERENCE RULE:**
  - Infer a practical gender presentation (male or female) when not explicit, based on narrative voice and genre conventions.
  - Keep age_range and appearance internally consistent for rendering.
  - Keep ethnicity/cultural labels only when explicitly supported by story text.

  **FORBIDDEN KEYWORDS (do not use):**
  - Style terms: manhwa, webtoon, aesthetic, K-drama, Korean male lead, romance female lead, Naver webtoon
  - Subjective style terms: authentic, trending, flower-boy, statuesque, willowy

  **ALLOWED: Objective morphological descriptions:**
  - Physical measurements: height, build, proportions
  - Hair: color, length, texture, style
  - Face: shape, features, expression tendencies
  - Body: build type, proportions, posture

  Current characters:
  {{ characters_json }}

  Story context:
  {{ story_context }}

  {% if image_style_guide %}
  IMAGE STYLE GUIDE (use for proportions/visual conventions ONLY, do NOT copy style keywords):
  {{ image_style_guide }}
  {% endif %}

  {% if character_style_guide %}
  CHARACTER STYLE GUIDE (use for gender dimorphism, facial construction, proportions; do NOT copy style keywords):
  {{ character_style_guide }}
  {% endif %}

  **AGE-BASED PHYSICAL STANDARDS (Style-Agnostic):**

  MALE CHARACTERS:
  - child (under 12): Small proportions 1:3 head-to-body ratio, round face, large eyes, playful posture
  - teen (13-19): Soft angular face, slender build, 170-178cm, developing features
  - young_adult (20-35): Defined jawline, tall slender 180-188cm, athletic or lean build
  - middle_aged (40-55): Mature features, subtle grey at temples, 178-185cm, confident posture
  - elderly (60+): Gentle lines, silver/white hair, 170-175cm, dignified bearing

  FEMALE CHARACTERS:
  - child (under 12): Small proportions 1:3 head-to-body ratio, large eyes, round cheeks, cute hairstyles
  - teen (13-19): Large eyes, slender figure, 160-170cm, graceful posture
  - young_adult (20-35): Tall figure 165cm+, long legs, defined proportions, smooth skin
  - middle_aged (40-55): Mature features with subtle lines, 160-170cm, elegant bearing
  - elderly (60+): Smile lines, grey hair, 155-165cm, gentle posture

  For each character, provide:
  - gender: male|female
  - age_range: child|teen|young_adult|adult|middle_aged|elderly
  - appearance:
    - hair: color, style, length (be specific: "soft side-swept black bangs" not just "black hair")
    - face: features, expression tendency (e.g., "gentle angular jawline, warm expressive eyes")
    - build: body type, height, proportions (e.g., "slender build, 180cm, lean proportions")
  - outfit: typical clothing with detail (e.g., "casual cream sweater, fitted dark jeans, clean white sneakers")
  - identity_line: Single comprehensive line for artist (150+ characters, NO STYLE KEYWORDS)

  **IDENTITY LINE FORMAT (Style-Neutral):**
  "[age_range] [ethnicity-or-unspecified] [gender-or-unknown], [hair description], [face/expression], [build/height], [typical outfit]"

  **GOOD EXAMPLE (Style-Neutral):**
  "early_20s Korean female, long flowing black hair with soft waves, large expressive eyes with delicate lashes, tall slender figure 168cm with long legs, cream knit sweater and high-waisted jeans"

  **BAD EXAMPLE (contains style keywords):**
  "early_20s Korean female, long flowing black hair, large doe eyes, statuesque figure 168cm, cream sweater, authentic webtoon romance female lead aesthetic"

  **BAD EXAMPLE (too vague):**
  "young woman with dark hair, normal build, casual clothes"

  OUTPUT SCHEMA:
  {
    "characters": [
      {
        "name": "Character name",
        "role": "main|secondary",
        "description": "Brief personality/role description",
        "gender": "male|female|unknown",
        "age_range": "young_adult",
        "appearance": {
          "hair": "detailed hair description with color, style, length",
          "face": "facial features and typical expression",
          "build": "body type, height in cm, proportions"
        },
        "outfit": "detailed typical outfit description",
        "identity_line": "Complete 150+ character morphological description (NO STYLE KEYWORDS)"
      }
    ]
  }
