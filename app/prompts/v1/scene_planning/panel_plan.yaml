# Panel Plan Prompt
# Version: 1.0
# Description: Create panel plan for webtoon sequence
# Required Variables: panel_count, char_list, scene_text, intent_block (optional), importance_block (optional), qc_block (optional)
# Output Schema: { panels: [{ panel_index, grammar_id, story_function, panel_role, panel_purpose, has_dialogue, utility_score, beat_summary }] }

prompt_panel_plan: |
  {{ global_constraints }}

  Create a flexible panel plan for a webtoon scene.
  This is NOT a storyboard and NOT animation frames.

  Your task is to suggest a sequence of visual moments that best communicate:

  - story
  - emotion
  - rhythm

  You may vary panel sizes and importance.
  Panels do NOT need to be equal.

  INPUT CONTEXT:
  {% if intent_block %}
  {{ intent_block }}
  {% endif %}
  {% if importance_block %}
  {{ importance_block }}
  {% endif %}
  Characters: {{ char_list }}
  {% if qc_block %}
  {{ qc_block }}
  {% endif %}

  AVAILABLE GRAMMAR IDs (choose what makes sense, do NOT force variety):

  - establishing (map from: establishing)
  - dialogue_medium (map from: dialogue)
  - emotion_closeup (map from: emotion_focus)
  - action
  - reaction
  - object_focus
  - reveal
  - impact_silence

  OUTPUT SCHEMA:
  {
    "panel_count": number,
    "layout_strategy": "uniform | dominant_with_insets | mixed | freeform",
    "panels": [
      {
        "panel_index": number,
        "grammar_id": "establishing | dialogue_medium | emotion_closeup | action | reaction | object_focus | reveal | impact_silence",
        "importance_weight": 0.0-1.0,
        "recommended_focus": "what the reader should visually focus on",
        "notes": "why this panel exists in the story (emotion, pacing, transition, etc)"
      }
    ]
  }

  RULES (IMPORTANT):

  - You are allowed to use multiple similar panels IF continuity_preference is high
  - You are allowed to skip close-ups or object shots entirely if not useful
  - If there is an emotional peak, at least ONE panel should have high importance_weight
  - Do NOT force balance â€” imbalance is allowed and encouraged

  DO NOT:

  - Do NOT evenly divide panels by default
  - Do NOT assume every panel shows full characters
  - Do NOT design animation-like frame sequences unless continuity is clearly preferred

  Scene text:
  {{ scene_text }}
